import openai

def generate_tarot_fortune(question: str) -> dict:
    prompt = f"""
以下はお客様からのご相談内容です：
「{question}」

この相談に対して、ケルト十字スプレッド（10枚）を使用し、タロット占いを行ってください。

🔸使用ルール
- 大アルカナ・小アルカナの両方を使用可
- 各カードの正位置／逆位置を明記し、その意味を文章内に反映してください
- 各カードは以下の形式で記述してください：

【ポジション名】（カード名・正/逆位置）
簡易解釈：
相談者への解釈：

🔸構成と文体ルール
1. 最初にカード全体の印象（50〜100字程度）を簡潔に記述
2. 上記フォーマットで10枚すべてを展開（わかりやすく丁寧に）
3. 最後に【総合読み解きとアドバイス】という見出しのもとで：

   ・相談者が置かれている現状の本質をストーリー的に整理
   ・過去→現在→未来の流れの中で、何が転換点かを言語化
   ・旦那、家族、周囲、社会なども含めて状況を俯瞰する
   ・今後どんな選択肢があるかを考察
   ・最後に、心に響く一文で現実的な背中を押すアドバイスを記述

※この【総合読み解きとアドバイス】の段落は 800〜1,000文字を使って構いません

🔸文体トーン
- 商用印刷に使える品質
- 誠実で穏やかな敬体（丁寧語）
- 占い初心者でもわかるよう、心理的背景を丁寧に解説してください
"""

    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[
            {
                "role": "system",
                "content": "あなたは商用印刷鑑定文を作成するプロのタロット占い師です。"
            },
            {
                "role": "user",
                "content": prompt
            }
        ]
    )

    result_text = response.choices[0].message.content.strip()

    return {
        "question": question,
        "result_text": result_text
    }
