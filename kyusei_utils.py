
from datetime import date

# 九星の一覧（西暦ベースの本命星）
NINE_STARS = ["一白水星", "二黒土星", "三碧木星", "四緑木星", "五黄土星", "六白金星", "七赤金星", "八白土星", "九紫火星"]

def get_honmeisei(year: int, month: int, day: int) -> str:
    """
    節入り（2月3日以前は前年扱い）を考慮した九星気学の本命星を返す
    """
    if (month < 2) or (month == 2 and day <= 3):
        year -= 1

    base_year = 1900  # 1900年は三碧木星（3）を基準とする
    index = (3 - ((year - base_year) % 9)) % 9
    index = 8 if index == 0 else index - 1  # 0〜8のインデックスに変換
    return NINE_STARS[index]


# 月盤の吉凶方位（2025年4月と5月のみ簡易定義）
MONTHLY_DIRECTIONS = {
    "2025-04": {
        "一白水星": {"吉": ["東"], "凶": ["西"]},
        "二黒土星": {"吉": ["北東"], "凶": ["南"]},
        "三碧木星": {"吉": ["南"], "凶": ["北"]},
        "四緑木星": {"吉": ["南東"], "凶": ["北西"]},
        "五黄土星": {"吉": ["西"], "凶": ["東"]},
        "六白金星": {"吉": ["北"], "凶": ["南東"]},
        "七赤金星": {"吉": ["北西"], "凶": ["南西"]},
        "八白土星": {"吉": ["南西"], "凶": ["北東"]},
        "九紫火星": {"吉": ["南東"], "凶": ["西"]},
    },
    "2025-05": {
        "一白水星": {"吉": ["南東"], "凶": ["北西"]},
        "二黒土星": {"吉": ["西"], "凶": ["東"]},
        "三碧木星": {"吉": ["北東"], "凶": ["南"]},
        "四緑木星": {"吉": ["東"], "凶": ["西"]},
        "五黄土星": {"吉": ["北"], "凶": ["南東"]},
        "六白金星": {"吉": ["南"], "凶": ["北"]},
        "七赤金星": {"吉": ["南西"], "凶": ["北東"]},
        "八白土星": {"吉": ["北西"], "凶": ["南西"]},
        "九紫火星": {"吉": ["東"], "凶": ["西"]},
    }
}

# 九星気学 吉方位文（1行）を生成
def get_kyusei_fortune(year: int, month: int, day: int) -> str:
    honmei = get_honmeisei(year, month, day)
    ym_now = "2025-04"
    ym_next = "2025-05"
    now = MONTHLY_DIRECTIONS.get(ym_now, {}).get(honmei, {})
    nex = MONTHLY_DIRECTIONS.get(ym_next, {}).get(honmei, {})
    msg = f"今月の吉方位は{','.join(now.get('吉', []))}、凶方位は{','.join(now.get('凶', []))}。"
    msg += f"来月は{','.join(nex.get('吉', []))}、凶方位は{','.join(nex.get('凶', []))}。"
    return msg
