
from datetime import date

# 九星の一覧（西暦ベースの本命星）
NINE_STARS = ["一白水星", "二黒土星", "三碧木星", "四緑木星", "五黄土星", "六白金星", "七赤金星", "八白土星", "九紫火星"]

def get_honmeisei(year: int, month: int, day: int) -> str:
    """
    正確な九星気学の本命星を返す（節入り＝立春2月4日基準）
    """
    # 立春（2/4）前は前年とみなす
    if month < 2 or (month == 2 and day < 4):
        year -= 1

    # 九星計算： 11 - (年 % 9)
    kyusei_num = (11 - (year % 9)) % 9
    kyusei_num = 9 if kyusei_num == 0 else kyusei_num

    kyusei_map = {
        1: "一白水星",
        2: "二黒土星",
        3: "三碧木星",
        4: "四緑木星",
        5: "五黄土星",
        6: "六白金星",
        7: "七赤金星",
        8: "八白土星",
        9: "九紫火星"
    }

    return kyusei_map[kyusei_num]



# 月盤の吉凶方位（2025年4月と5月のみ簡易定義）
MONTHLY_DIRECTIONS = {
    "2025-04": {
        "一白水星": {"吉": ["東"], "凶": ["西"]},
        "二黒土星": {"吉": ["北東"], "凶": ["南"]},
        "三碧木星": {"吉": ["南"], "凶": ["北"]},
        "四緑木星": {"吉": ["南東"], "凶": ["北西"]},
        "五黄土星": {"吉": ["西"], "凶": ["東"]},
        "六白金星": {"吉": ["北"], "凶": ["南東"]},
        "七赤金星": {"吉": ["北西"], "凶": ["南西"]},
        "八白土星": {"吉": ["南西"], "凶": ["北東"]},
        "九紫火星": {"吉": ["南東"], "凶": ["西"]},
    },
    "2025-05": {
        "一白水星": {"吉": ["南東"], "凶": ["北西"]},
        "二黒土星": {"吉": ["西"], "凶": ["東"]},
        "三碧木星": {"吉": ["北東"], "凶": ["南"]},
        "四緑木星": {"吉": ["東"], "凶": ["西"]},
        "五黄土星": {"吉": ["北"], "凶": ["南東"]},
        "六白金星": {"吉": ["南"], "凶": ["北"]},
        "七赤金星": {"吉": ["南西"], "凶": ["北東"]},
        "八白土星": {"吉": ["北西"], "凶": ["南西"]},
        "九紫火星": {"吉": ["東"], "凶": ["西"]},
    }
}

# 九星気学 吉方位文（1行）を生成
def get_kyusei_fortune(year: int, month: int, day: int) -> str:
    honmei = get_honmeisei(year, month, day)
    ym_now = "2025-04"
    ym_next = "2025-05"
    now = MONTHLY_DIRECTIONS.get(ym_now, {}).get(honmei, {})
    nex = MONTHLY_DIRECTIONS.get(ym_next, {}).get(honmei, {})
    msg = f"今月の吉方位は{','.join(now.get('吉', []))}、凶方位は{','.join(now.get('凶', []))}。"
    msg += f"来月は{','.join(nex.get('吉', []))}、凶方位は{','.join(nex.get('凶', []))}。"
    return msg
